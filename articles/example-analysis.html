<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Transform camera trap data to recurrent events data • ctrecurrent</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Transform camera trap data to recurrent events data">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">


    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">ctrecurrent</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/example-analysis.html">Example analysis</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/adibender/ctrecurent" class="external-link">
    <span class="fa fa-github fa-lg"></span>

  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Transform camera trap data to recurrent events
data</h1>
            
            <h4 data-toc-skip class="date">2025-07-17</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/adibender/ctrecurrent/blob/main/vignettes/example-analysis.Rmd" class="external-link"><code>vignettes/example-analysis.Rmd</code></a></small>
      <div class="hidden name"><code>example-analysis.Rmd</code></div>

    </div>

    
    
<p>The goal of <strong><code>ctrecurrent</code></strong> is to transform
the camera trap data into a format suitable for recurrent event
analysis. It contains the function <code>ct_torecurrent</code> to do so,
requiring a data frame with the following information for each
observation<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a>:</p>
<ul>
<li>Site ID,</li>
<li>Timestamp (Date and Time) and</li>
<li>Species</li>
</ul>
<div class="section level2">
<h2 id="overview-of-the-raw-data">Overview of the raw data<a class="anchor" aria-label="anchor" href="#overview-of-the-raw-data"></a>
</h2>
<p>In the first step we look at the <code><a href="../reference/murphy.html">?murphy</a></code> data available
with the package:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Attaching package: 'dplyr'</span></span></code></pre>
<pre><code><span><span class="co">## The following objects are masked from 'package:stats':</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     filter, lag</span></span></code></pre>
<pre><code><span><span class="co">## The following objects are masked from 'package:base':</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     intersect, setdiff, setequal, union</span></span></code></pre>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://adibender.github.io/pammtools/" class="external-link">pammtools</a></span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Attaching package: 'pammtools'</span></span></code></pre>
<pre><code><span><span class="co">## The following object is masked from 'package:stats':</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     filter</span></span></code></pre>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme_get.html" class="external-link">theme_set</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://patchwork.data-imaginist.com" class="external-link">patchwork</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/stc04003/reReg" class="external-link">reReg</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://adibender.github.io/ctrecurrent/" class="external-link">ctrecurrent</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">murphy</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 6 × 4</span></span></span>
<span><span class="co">##   Site     Species DateTime            matrix</span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dttm&gt;</span>              <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span> 2016BE02 Bear    2016-07-27 <span style="color: #949494;">05:52:00</span> agdev </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span> 2016BE02 Fawn    2016-07-29 <span style="color: #949494;">17:25:00</span> agdev </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span> 2016BE02 Bear    2016-08-15 <span style="color: #949494;">10:26:00</span> agdev </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">4</span> 2016BE02 Fawn    2016-08-15 <span style="color: #949494;">15:59:00</span> agdev </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">5</span> 2016BE02 Coyote  2016-08-16 <span style="color: #949494;">21:41:00</span> agdev </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">6</span> 2016BE02 Coyote  2016-08-19 <span style="color: #949494;">06:53:00</span> agdev</span></span></code></pre>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">murphy</span><span class="op">$</span><span class="va">Species</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "Bear"      "Fawn"      "Coyote"    "Bobcat"    "Human"     "Deer"     </span></span>
<span><span class="co">## [7] "Motorized"</span></span></code></pre>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="va">murphy</span><span class="op">$</span><span class="va">DateTime</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "2016-05-23 20:41:00 UTC" "2017-09-12 09:03:00 UTC"</span></span></code></pre>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">murphy</span><span class="op">$</span><span class="va">matrix</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">##  agdev forest </span></span>
<span><span class="co">##   1799   2337</span></span></code></pre>
<p>As we can see above, the camera captured different types of objects.
In the analysis below, we will focus on “Deer” as the primary species
and “Coyote” as secondary. Everything else will be considered tertiary
species. Thse <code>matrix</code> covariate contains information about
the environment in which the camera is placed, either agriculturally
developed or forest.</p>
</div>
<div class="section level2">
<h2 id="defining-the-parameters-of-the-survey">Defining the parameters of the survey<a class="anchor" aria-label="anchor" href="#defining-the-parameters-of-the-survey"></a>
</h2>
<p>In the next step, we have to define which species we want to consider
as the <strong>primary</strong> and <strong>secondary</strong>. This is
important, as this dictates the direction of the effect. Below we define
“Deer” as the primary species and “Coyote” as secondary, thus the model
will estimate how the presence of Deer affects the time until the
occurence of a Coyote. Occurence of a <strong>tertiary</strong> species
will be considered a censoring event. Finally, we have to set the end
date of the study. The last two arguments do not necessarily need to be
specified, the default is to take all species outside of primary and
secondary as tertiary and the maximum date in the data as survey end
date.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">primary</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Deer"</span><span class="op">)</span></span>
<span><span class="va">secondary</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Coyote"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Define the tertiary species (affecting the secondary species, censoring the survey if observed but not being the focus of the model)</span></span>
<span><span class="va">tertiary</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Fawn"</span>, <span class="st">"Bear"</span>, <span class="st">"Bobcat"</span>, <span class="st">"Human"</span>, <span class="st">"Motorized"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Define the end of study</span></span>
<span><span class="va">end_date</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">murphy</span><span class="op">$</span><span class="va">DateTime</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="transform-the-raw-data-for-analysis">Transform the raw data for analysis<a class="anchor" aria-label="anchor" href="#transform-the-raw-data-for-analysis"></a>
</h2>
<p>The data transformation for analysis consists of 2 steps</p>
<ol style="list-style-type: decimal">
<li>transform data to general recurrent events formats (function
<code>ct_to_recurrent</code>). Here, at each site, we look for the first
occurence of the primary species, which indicates the start of the first
survey at this site. Covariate information is added as needed. Occurence
of the secondary species will be considered a (recurrent) event within
each survey, and the survey at that site continues until
<ul>
<li>occurence of a tertiary species (end of survey -&gt; censoring)</li>
<li>end of survey period (<code>survey_duration</code> -&gt;
administrative censoring)</li>
<li>re-occurence of the primary species (start of a new survey)</li>
</ul>
</li>
<li>transform the “piece-wise exponential data” (PED) format for
analysis using PAMMs (function <code>as_ped</code> from
<strong><code>pammtools</code></strong> package). This transforms the
time-to-event data from the recurrence data from step 1. by splitting
the time-axis in intervals which facilitates estimation of the hazard
for an occurence of the secondary species (see <a href="https://adibender.github.io/pammtools/articles/data-transformation.html" class="external-link">here</a>
and <a href="https://adibender.github.io/pammtools/articles/recurrent-events.html" class="external-link">here</a>)</li>
</ol>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Step 1) transform to recurrent event format</span></span>
<span><span class="co"># note that datetime_var, species_var and site_var have defaults, but they need to</span></span>
<span><span class="co"># be adjusted if your column names are different</span></span>
<span><span class="va">recu</span> <span class="op">=</span> <span class="fu"><a href="../reference/ct_to_recurrent.html">ct_to_recurrent</a></span><span class="op">(</span></span>
<span>  data            <span class="op">=</span> <span class="va">murphy</span>,</span>
<span>  primary         <span class="op">=</span> <span class="va">primary</span>,</span>
<span>  secondary       <span class="op">=</span> <span class="va">secondary</span>,</span>
<span>  tertiary        <span class="op">=</span> <span class="va">tertiary</span>,</span>
<span>  datetime_var    <span class="op">=</span> <span class="st">"DateTime"</span>,</span>
<span>  species_var     <span class="op">=</span> <span class="st">"Species"</span>,</span>
<span>  site_var        <span class="op">=</span> <span class="st">"Site"</span>,</span>
<span>  survey_end_date <span class="op">=</span> <span class="va">end_date</span>,</span>
<span>  survey_duration <span class="op">=</span> <span class="fl">30</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Joining with `by = join_by(survey_id)`</span></span></code></pre>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">recu</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">Site</span>, <span class="va">survey_id</span>, <span class="va">t.start</span>, <span class="va">t.stop</span>, <span class="va">event</span>, <span class="va">status</span>, <span class="va">enum</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 221 × 7</span></span></span>
<span><span class="co">## <span style="color: #949494;"># Groups:   survey_id [99]</span></span></span>
<span><span class="co">##    Site       survey_id    t.start t.stop event status  enum</span></span>
<span><span class="co">##    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 1</span> 2016BE15   2016BE15-3     0     10.8       1      0     1</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 2</span> 2016BE15   2016BE15-3    10.8   30         0      0     2</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 3</span> 2016BE22   2016BE22-6     0      0.344     1      0     1</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 4</span> 2016BE22   2016BE22-6     0.344  0.939     0      0     2</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 5</span> 2016BE22   2016BE22-9     0      5.89      1      0     1</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 6</span> 2016BE22   2016BE22-9     5.89   7.37      0      0     2</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 7</span> 2016BE98   2016BE98-3     0     18.0       1      0     1</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 8</span> 2016BE98   2016BE98-3    18.0   20.8       0      0     2</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 9</span> 2016ROTH23 2016ROTH23-1   0     20.8       1      0     1</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">10</span> 2016ROTH23 2016ROTH23-1  20.8   30         0      0     2</span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 211 more rows</span></span></span></code></pre>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Merge covariate information with recurrent events data table</span></span>
<span><span class="va">cov</span> <span class="op">=</span> <span class="va">murphy</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">Site</span>, <span class="va">matrix</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html" class="external-link">distinct</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">data</span> <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">recu</span>, <span class="va">cov</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Joining with `by = join_by(Site)`</span></span></code></pre>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">Site</span>, <span class="va">survey_id</span>, <span class="va">primary</span>, <span class="va">secondary</span>, <span class="va">t.start</span>, <span class="va">t.stop</span>, <span class="va">event</span>, <span class="va">matrix</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 221 × 8</span></span></span>
<span><span class="co">## <span style="color: #949494;"># Groups:   survey_id [99]</span></span></span>
<span><span class="co">##    Site       survey_id    primary secondary t.start t.stop event matrix</span></span>
<span><span class="co">##    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 1</span> 2016BE15   2016BE15-3   Deer    Coyote      0     10.8       1 agdev </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 2</span> 2016BE15   2016BE15-3   Deer    Coyote     10.8   30         0 agdev </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 3</span> 2016BE22   2016BE22-6   Deer    Coyote      0      0.344     1 agdev </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 4</span> 2016BE22   2016BE22-6   Deer    Coyote      0.344  0.939     0 agdev </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 5</span> 2016BE22   2016BE22-9   Deer    Coyote      0      5.89      1 agdev </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 6</span> 2016BE22   2016BE22-9   Deer    Coyote      5.89   7.37      0 agdev </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 7</span> 2016BE98   2016BE98-3   Deer    Coyote      0     18.0       1 agdev </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 8</span> 2016BE98   2016BE98-3   Deer    Coyote     18.0   20.8       0 agdev </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 9</span> 2016ROTH23 2016ROTH23-1 Deer    Coyote      0     20.8       1 agdev </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">10</span> 2016ROTH23 2016ROTH23-1 Deer    Coyote     20.8   30         0 agdev </span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 211 more rows</span></span></span></code></pre>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Events plot</span></span>
<span><span class="fu">reReg</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/reReg/man/plotEvents.html" class="external-link">plotEvents</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://wwenjie.org/reda/reference/Recur.html" class="external-link">Recur</a></span><span class="op">(</span><span class="va">t.start</span> <span class="op"><a href="https://wwenjie.org/reda/reference/Recur-to.html" class="external-link">%to%</a></span> <span class="va">t.stop</span>, <span class="va">survey_id</span>, <span class="va">event</span>, <span class="va">status</span><span class="op">)</span> <span class="op">~</span> <span class="fl">1</span>,</span>
<span>  data <span class="op">=</span> <span class="va">data</span>,</span>
<span>  xlab <span class="op">=</span> <span class="st">"Time in days"</span>,</span>
<span>  ylab <span class="op">=</span> <span class="st">"Subjects arranged by terminal time"</span><span class="op">)</span></span></code></pre></div>
<p><img src="example-analysis_files/figure-html/unnamed-chunk-4-1.png" width="480" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># By levels of matrix landscape</span></span>
<span><span class="fu">reReg</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/reReg/man/plotEvents.html" class="external-link">plotEvents</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://wwenjie.org/reda/reference/Recur.html" class="external-link">Recur</a></span><span class="op">(</span><span class="va">t.start</span> <span class="op"><a href="https://wwenjie.org/reda/reference/Recur-to.html" class="external-link">%to%</a></span> <span class="va">t.stop</span>, <span class="va">survey_id</span>, <span class="va">event</span>, <span class="va">status</span><span class="op">)</span> <span class="op">~</span> <span class="va">matrix</span>,</span>
<span>  data <span class="op">=</span> <span class="va">data</span>,</span>
<span>  xlab <span class="op">=</span> <span class="st">"Time in days"</span>,</span>
<span>  ylab <span class="op">=</span> <span class="st">"Subjects arranged by terminal time"</span><span class="op">)</span></span></code></pre></div>
<p><img src="example-analysis_files/figure-html/unnamed-chunk-4-2.png" width="480" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># PED transformation</span></span>
<span><span class="va">ped</span> <span class="op">=</span> <span class="va">data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://adibender.github.io/pammtools/reference/as_ped.html" class="external-link">as_ped</a></span><span class="op">(</span></span>
<span>    formula    <span class="op">=</span> <span class="fu">Surv</span><span class="op">(</span><span class="va">t.start</span>, <span class="va">t.stop</span>, <span class="va">event</span><span class="op">)</span><span class="op">~</span> <span class="va">matrix</span> <span class="op">+</span> <span class="va">Site</span>,</span>
<span>    id         <span class="op">=</span> <span class="st">"survey_id"</span>,</span>
<span>    transition <span class="op">=</span> <span class="st">"enum"</span>,</span>
<span>    timescale  <span class="op">=</span> <span class="st">"calendar"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>Site <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">Site</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>survey_id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">survey_id</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># check the data for one survey</span></span>
<span><span class="va">ped</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">survey_id</span> <span class="op">==</span> <span class="st">"2016BE15-3"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">enum</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html" class="external-link">slice</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">survey_id</span>, <span class="va">tstart</span>, <span class="va">tend</span>, <span class="va">enum</span>, <span class="va">ped_status</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 4 × 5</span></span></span>
<span><span class="co">## <span style="color: #949494;"># Groups:   enum [2]</span></span></span>
<span><span class="co">##   survey_id  tstart     tend  enum ped_status</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">*</span> <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span> 2016BE15-3    0    0.003<span style="text-decoration: underline;">47</span>     1          0</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span> 2016BE15-3   10.8 10.8         1          1</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span> 2016BE15-3   10.8 11.0         2          0</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">4</span> 2016BE15-3   24.8 24.8         2          0</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="fit-the-model">Fit the model<a class="anchor" aria-label="anchor" href="#fit-the-model"></a>
</h2>
<p>In the final step, we fit a model to the PED data, which differs
depending on the assumptions about the process. Here we fit 4 models</p>
<ul>
<li>
<code>m_null</code>: baseline model for hazard of Coyote occurence
(without covariates)</li>
<li>
<code>m_ph</code>: proportional hazards model for the effect of
landscape</li>
<li>
<code>m_tv</code>: stratified hazards model (each landscape category
has its own baseline hazard)</li>
<li>
<code>m_re</code>: As <code>m_tv</code> but with random effect for
camera trap site</li>
</ul>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Baseline model</span></span>
<span><span class="va">m_null</span> <span class="op">=</span> <span class="fu"><a href="https://adibender.github.io/pammtools/reference/pamm.html" class="external-link">pamm</a></span><span class="op">(</span></span>
<span>  formula <span class="op">=</span> <span class="va">ped_status</span> <span class="op">~</span> <span class="fu">s</span><span class="op">(</span><span class="va">tend</span><span class="op">)</span>,</span>
<span>  data <span class="op">=</span> <span class="va">ped</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning: glm.fit: fitted rates numerically 0 occurred</span></span>
<span><span class="co">## Warning: glm.fit: fitted rates numerically 0 occurred</span></span></code></pre>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">m_null</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Family: poisson </span></span>
<span><span class="co">## Link function: log </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Formula:</span></span>
<span><span class="co">## ped_status ~ s(tend)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Parametric coefficients:</span></span>
<span><span class="co">##             Estimate Std. Error z value Pr(&gt;|z|)    </span></span>
<span><span class="co">## (Intercept) -1.63064    0.09475  -17.21   &lt;2e-16 ***</span></span>
<span><span class="co">## ---</span></span>
<span><span class="co">## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Approximate significance of smooth terms:</span></span>
<span><span class="co">##           edf Ref.df Chi.sq  p-value    </span></span>
<span><span class="co">## s(tend) 4.196  5.167  40.32 1.48e-06 ***</span></span>
<span><span class="co">## ---</span></span>
<span><span class="co">## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## R-sq.(adj) =  -0.00655   Deviance explained = 2.95%</span></span>
<span><span class="co">## UBRE = -0.89609  Scale est. = 1         n = 12521</span></span></code></pre>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Proporitional hazards effect of landscape (matrix)</span></span>
<span><span class="va">m_ph</span> <span class="op">=</span> <span class="fu"><a href="https://adibender.github.io/pammtools/reference/pamm.html" class="external-link">pamm</a></span><span class="op">(</span></span>
<span>  formula <span class="op">=</span> <span class="va">ped_status</span> <span class="op">~</span> <span class="va">matrix</span> <span class="op">+</span> <span class="fu">s</span><span class="op">(</span><span class="va">tend</span><span class="op">)</span>,</span>
<span>  data <span class="op">=</span> <span class="va">ped</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning: glm.fit: fitted rates numerically 0 occurred</span></span>
<span><span class="co">## Warning: glm.fit: fitted rates numerically 0 occurred</span></span></code></pre>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">m_ph</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Family: poisson </span></span>
<span><span class="co">## Link function: log </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Formula:</span></span>
<span><span class="co">## ped_status ~ matrix + s(tend)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Parametric coefficients:</span></span>
<span><span class="co">##              Estimate Std. Error z value Pr(&gt;|z|)    </span></span>
<span><span class="co">## (Intercept)   -1.7212     0.1675 -10.277   &lt;2e-16 ***</span></span>
<span><span class="co">## matrixforest   0.1319     0.1971   0.669    0.503    </span></span>
<span><span class="co">## ---</span></span>
<span><span class="co">## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Approximate significance of smooth terms:</span></span>
<span><span class="co">##         edf Ref.df Chi.sq  p-value    </span></span>
<span><span class="co">## s(tend) 4.2  5.172  40.02 1.68e-06 ***</span></span>
<span><span class="co">## ---</span></span>
<span><span class="co">## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## R-sq.(adj) =  -0.0066   Deviance explained = 2.98%</span></span>
<span><span class="co">## UBRE = -0.89596  Scale est. = 1         n = 12521</span></span></code></pre>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span> <span class="co"># Time-varying covariate effect</span></span>
<span><span class="va">m_tv</span> <span class="op">=</span> <span class="fu"><a href="https://adibender.github.io/pammtools/reference/pamm.html" class="external-link">pamm</a></span><span class="op">(</span></span>
<span>  formula <span class="op">=</span> <span class="va">ped_status</span> <span class="op">~</span> <span class="va">matrix</span> <span class="op">+</span> <span class="fu">s</span><span class="op">(</span><span class="va">tend</span><span class="op">)</span> <span class="op">+</span></span>
<span>     <span class="fu">s</span><span class="op">(</span><span class="va">tend</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.ordered</a></span><span class="op">(</span><span class="va">matrix</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  data <span class="op">=</span> <span class="va">ped</span>,</span>
<span>  engine <span class="op">=</span> <span class="st">"bam"</span>, method <span class="op">=</span> <span class="st">"fREML"</span>,  discrete <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning in bgam.fitd(G, mf, gp, scale, nobs.extra = 0, rho = rho, coef = coef,</span></span>
<span><span class="co">## : fitted rates numerically 0 occurred</span></span></code></pre>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">m_tv</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Family: poisson </span></span>
<span><span class="co">## Link function: log </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Formula:</span></span>
<span><span class="co">## ped_status ~ matrix + s(tend) + s(tend, by = as.ordered(matrix))</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Parametric coefficients:</span></span>
<span><span class="co">##              Estimate Std. Error z value Pr(&gt;|z|)    </span></span>
<span><span class="co">## (Intercept)   -1.9457     0.1659 -11.727   &lt;2e-16 ***</span></span>
<span><span class="co">## matrixforest   0.1303     0.1989   0.655    0.512    </span></span>
<span><span class="co">## ---</span></span>
<span><span class="co">## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Approximate significance of smooth terms:</span></span>
<span><span class="co">##                                    edf Ref.df Chi.sq  p-value    </span></span>
<span><span class="co">## s(tend)                          3.976  4.905 22.616 0.000379 ***</span></span>
<span><span class="co">## s(tend):as.ordered(matrix)forest 1.187  1.338  0.227 0.866032    </span></span>
<span><span class="co">## ---</span></span>
<span><span class="co">## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## R-sq.(adj) =  -0.00675   Deviance explained = -14.2%</span></span>
<span><span class="co">## fREML =  12161  Scale est. = 1         n = 12521</span></span></code></pre>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span> <span class="va">m_re</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://adibender.github.io/pammtools/reference/pamm.html" class="external-link">pamm</a></span><span class="op">(</span></span>
<span>  formula <span class="op">=</span> <span class="va">ped_status</span> <span class="op">~</span> <span class="va">matrix</span> <span class="op">+</span> <span class="fu">s</span><span class="op">(</span><span class="va">tend</span><span class="op">)</span> <span class="op">+</span> <span class="fu">s</span><span class="op">(</span><span class="va">tend</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.ordered</a></span><span class="op">(</span><span class="va">matrix</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">s</span><span class="op">(</span><span class="va">Site</span>, bs <span class="op">=</span> <span class="st">"re"</span><span class="op">)</span>,</span>
<span>  data <span class="op">=</span> <span class="va">ped</span>, engine <span class="op">=</span> <span class="st">"bam"</span>, method <span class="op">=</span> <span class="st">"fREML"</span>, discrete <span class="op">=</span> <span class="cn">TRUE</span></span>
<span> <span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning in bgam.fitd(G, mf, gp, scale, nobs.extra = 0, rho = rho, coef = coef,</span></span>
<span><span class="co">## : fitted rates numerically 0 occurred</span></span></code></pre>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">m_re</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Family: poisson </span></span>
<span><span class="co">## Link function: log </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Formula:</span></span>
<span><span class="co">## ped_status ~ matrix + s(tend) + s(tend, by = as.ordered(matrix)) + </span></span>
<span><span class="co">##     s(Site, bs = "re")</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Parametric coefficients:</span></span>
<span><span class="co">##              Estimate Std. Error z value Pr(&gt;|z|)    </span></span>
<span><span class="co">## (Intercept)   -1.9457     0.1659 -11.727   &lt;2e-16 ***</span></span>
<span><span class="co">## matrixforest   0.1303     0.1989   0.655    0.512    </span></span>
<span><span class="co">## ---</span></span>
<span><span class="co">## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Approximate significance of smooth terms:</span></span>
<span><span class="co">##                                        edf Ref.df Chi.sq p-value    </span></span>
<span><span class="co">## s(tend)                          3.9763201  4.905 22.611 0.00038 ***</span></span>
<span><span class="co">## s(tend):as.ordered(matrix)forest 1.1867311  1.338  0.226 0.86635    </span></span>
<span><span class="co">## s(Site)                          0.0001174 69.000  0.000 0.99878    </span></span>
<span><span class="co">## ---</span></span>
<span><span class="co">## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## R-sq.(adj) =  -0.00675   Deviance explained = -14.2%</span></span>
<span><span class="co">## fREML =  12161  Scale est. = 1         n = 12521</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="effect-visualization">Effect visualization<a class="anchor" aria-label="anchor" href="#effect-visualization"></a>
</h2>
<p>While the models have their own default plot methods, the most
flexible way to visualize non-linear effects is to</p>
<ul>
<li>create a new data set with the covariate specification of interest
(<code>make_newdata</code>)</li>
<li>add the prediction of the quantity of interest (hazard, hazard
ratio, etc.) to your data (<code>add_*</code> functions), including
CIs</li>
<li>use your favorite tool for visualization (here we use
<strong><code>ggplot2</code></strong>)</li>
</ul>
<p>The <strong><code>pammtools</code></strong> package provides helper
functions for the first two steps.</p>
<p>In the first plot, we can see the attraction effect of deer on
coyotes lasts for about 5 days. Afterwards the hazard for the occurence
of coyotes is constant (the wigglines can be ignored since the
uncertainty is quiet high).</p>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span> <span class="co"># Null model</span></span>
<span><span class="va">ndf_null</span> <span class="op">&lt;-</span> <span class="va">ped</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://adibender.github.io/pammtools/reference/newdata.html" class="external-link">make_newdata</a></span><span class="op">(</span>tend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">tend</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://adibender.github.io/pammtools/reference/add_hazard.html" class="external-link">add_hazard</a></span><span class="op">(</span><span class="va">m_null</span><span class="op">)</span></span>
<span><span class="va">p_null</span> <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">ndf_null</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">tend</span>, y <span class="op">=</span> <span class="va">hazard</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>   <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>   <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html" class="external-link">geom_ribbon</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>ymin <span class="op">=</span> <span class="va">ci_lower</span>, ymax <span class="op">=</span> <span class="va">ci_upper</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">.3</span><span class="op">)</span> <span class="op">+</span></span>
<span>   <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"Time after white-tailed deer sighting (in days)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>   <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"Log-hazard for coyote occurence"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">p_null</span><span class="op">)</span></span></code></pre></div>
<p><img src="example-analysis_files/figure-html/unnamed-chunk-6-1.png" width="480" style="display: block; margin: auto;"></p>
<p>In the second plot, we plot the hazards for coyote occurence for each
category of landscape (<code>matrix</code>) in one plot (left panel) and
their hazard ratio(right panel). This indicates (hazard ratio = 1), that
given a sighting of a deer (primary), occurence of coyotes is not
affected by the type of landscape in which the deer was sighted.</p>
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Stratified hazards</span></span>
<span><span class="va">ndf_tv</span> <span class="op">&lt;-</span> <span class="va">ped</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://adibender.github.io/pammtools/reference/newdata.html" class="external-link">make_newdata</a></span><span class="op">(</span>tend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">tend</span><span class="op">)</span>, matrix <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">matrix</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://adibender.github.io/pammtools/reference/add_hazard.html" class="external-link">add_hazard</a></span><span class="op">(</span><span class="va">m_tv</span><span class="op">)</span></span>
<span><span class="va">p_tv</span> <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">ndf_tv</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">tend</span>, y <span class="op">=</span> <span class="va">hazard</span>, colour <span class="op">=</span> <span class="va">matrix</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>   <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>   <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html" class="external-link">geom_ribbon</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>ymin <span class="op">=</span> <span class="va">ci_lower</span>, ymax <span class="op">=</span> <span class="va">ci_upper</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">.3</span><span class="op">)</span> <span class="op">+</span></span>
<span>   <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_color_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"#999999"</span>, <span class="st">"#E69F00"</span><span class="op">)</span><span class="op">)</span>  <span class="op">+</span></span>
<span>   <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"Time after white-tailed deer sighting (in days)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>   <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"Log-hazard for coyote occurence"</span><span class="op">)</span></span>
<span><span class="va">ndf_hr</span> <span class="op">&lt;-</span> <span class="va">ped</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://adibender.github.io/pammtools/reference/newdata.html" class="external-link">make_newdata</a></span><span class="op">(</span>tend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">tend</span><span class="op">)</span>, matrix <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"agdev"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://adibender.github.io/pammtools/reference/add_hazard.html" class="external-link">add_hazard</a></span><span class="op">(</span><span class="va">m_tv</span>, reference <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>matrix <span class="op">=</span> <span class="st">"forest"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">p_hr</span> <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">ndf_hr</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">tend</span>, y <span class="op">=</span> <span class="va">hazard</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>   <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>   <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html" class="external-link">geom_ribbon</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>ymin <span class="op">=</span> <span class="va">ci_lower</span>, ymax <span class="op">=</span> <span class="va">ci_upper</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">.3</span><span class="op">)</span> <span class="op">+</span></span>
<span>   <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"Time after white-tailed deer sighting (in days)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>   <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"Hazard ratio for coyote occurence\n (agdev/forest"</span><span class="op">)</span></span>
<span><span class="va">p_tv</span> <span class="op">+</span> <span class="va">p_hr</span></span></code></pre></div>
<p><img src="example-analysis_files/figure-html/unnamed-chunk-7-1.png" width="576" style="display: block; margin: auto;"></p>
</div>
<div class="footnotes footnotes-end-of-document">
<hr>
<ol>
<li id="fn1"><p>If your data is a different format, you can try to bring
it into the required format before using the functions provided here, or
post an issue on GitHub if you use a common camera trap format, so we
can extend the provided functionality.<a href="#fnref1" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Nicolas Ferry.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

      </footer>
</div>






  </body>
</html>
